(()=>{"use strict";var t={891:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),r(142).config({silent:!0});let s={NODE_ENV:"production",DB_HOST:process.env.DB_HOST,DB_USERNAME:process.env.DB_USER,DB_PASSWORD:process.env.DB_PASSWORD,DB_PORT:parseInt(process.env.DB_PORT),DB_MYSQL:process.env.DB_MYSQL};e.default=s},350:function(t,e,r){var s=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))((function(u,o){function n(t){try{i(s.next(t))}catch(t){o(t)}}function a(t){try{i(s.throw(t))}catch(t){o(t)}}function i(t){var e;t.done?u(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,a)}i((s=s.apply(t,e||[])).next())}))},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dbConnection=e.db=void 0;const o=r(496),n=u(r(891));e.db=new o.Sequelize(n.default.DB_MYSQL,n.default.DB_USERNAME,n.default.DB_PASSWORD,{host:n.default.DB_HOST,port:n.default.DB_PORT,logging:console.log,pool:{max:5,idle:30},dialect:"mysql",dialectOptions:{ssl:"Amazon RDS"}});e.dbConnection=()=>s(void 0,void 0,void 0,(function*(){try{yield e.db.authenticate(),console.log("Application connected to Amazon RDS")}catch(t){throw new Error(t)}})),e.default=e.db},570:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertSQLToObject=void 0;e.convertSQLToObject=t=>{let e=[];return t.forEach((t=>{if(((t,e)=>{for(let r of t)if(r.SKU===e.SKU)return!0;return!1})(e,t)){const r=e.indexOf(e.find((e=>e.SKU===t.SKU)));e[r].attributes.push({name:t.attribute,measureUnit:t.measureUnit,value:t.value})}else e.push({SKU:t.SKU,name:t.name,price:t.price,type:t.type,attributes:[{name:t.attribute,measureUnit:t.measureUnit,value:t.value}]})})),e}},114:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(677);const u=s(r(660)),o=s(r(603)),n=process.env.PORT||3e3;o.default.listen(n,(()=>{u.default.info("Express server started on port: "+n)}))},677:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=s(r(17)),o=s(r(142)),n=s(r(944));(()=>{const t=(0,n.default)([{name:"env",alias:"e",defaultValue:"development",type:String}]),e=o.default.config({path:u.default.join(__dirname,`env/${t.env}.env`)});if(e.error)throw e.error})()},609:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=r(860),o=s(r(505)),n=(0,u.Router)();n.use("/products",o.default),e.default=n},505:function(t,e,r){var s=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))((function(u,o){function n(t){try{i(s.next(t))}catch(t){o(t)}}function a(t){try{i(s.throw(t))}catch(t){o(t)}}function i(t){var e;t.done?u(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,a)}i((s=s.apply(t,e||[])).next())}))},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.p=void 0;const o=u(r(10)),n=r(860),a=r(496),i=u(r(350)),d=r(570),c=(0,n.Router)(),{CREATED:l,OK:p,INTERNAL_SERVER_ERROR:f,BAD_REQUEST:y}=o.default;e.p={get:"/",add:"/",delete:"/:SKU",getAtt:"/attributes/",getTypes:"/types/"},c.get(e.p.get,((t,e)=>s(void 0,void 0,void 0,(function*(){try{const t=yield i.default.query('SELECT p.SKU, p.name, p.price, t.name as "type", a.name as "attribute", a.measureUnit, pa.value FROM product as p\n  JOIN type_product as t ON p.type_product_idtype_product=t.idtype_product\n  JOIN product_has_attribute as pa ON p.SKU=pa.product_SKU\n  JOIN attribute as a ON pa.attribute_idattribute=a.idattribute',{type:a.QueryTypes.SELECT});return e.status(p).json((0,d.convertSQLToObject)(t))}catch(t){return e.status(f)}})))),c.post(e.p.getAtt,((t,e)=>s(void 0,void 0,void 0,(function*(){const{attributes:r}=t.body;if(r[0]==={})return e.status(y).json({message:"No name of attribute"});try{const t="Select * FROM attribute;",s=yield i.default.query(t,{type:a.QueryTypes.SELECT});let u=[];return Object.keys(r[0]).forEach((t=>{const e=s.find((e=>e.name===t));let o;e&&(o=e.idattribute,u.push({idAttribute:o,value:r[0][t]}))})),e.status(p).json(u)}catch(t){return e.status(f)}})))),c.post(e.p.getTypes,((t,e)=>s(void 0,void 0,void 0,(function*(){const r=Object.keys(t.body)[0];if(""===r||!r)return e.status(y).json({message:"No name of type"});try{const t=`Select * FROM type_product WHERE name="${r}";`,s=yield i.default.query(t,{type:a.QueryTypes.SELECT});return e.status(p).json(s[0].idtype_product)}catch(t){return e.status(f)}})))),c.post(e.p.add,((t,e)=>s(void 0,void 0,void 0,(function*(){const{SKU:r,name:u,price:o,type:n,attributes:d}=t.body;if(!(r&&u&&o&&n&&d&&0!==d.length))return e.status(y).json({message:"Some value is missing"});const c=`SELECT * FROM product WHERE SKU=${parseInt(r)}`;if((yield i.default.query(c,{type:a.QueryTypes.SELECT})).length>0)return e.status(y).json({message:"The product SKU already exists"});yield d.forEach((t=>s(void 0,void 0,void 0,(function*(){const r=`SELECT * FROM type_product_has_attribute WHERE type_product_idtype_product=${n} AND attribute_idattribute=${t.idAttribute};`;if(0===(yield i.default.query(r,{type:a.QueryTypes.SELECT})).length)return e.status(y).json({message:"The attribute assigned not match with the product type"})}))));const p=`SELECT * FROM type_product_has_attribute WHERE type_product_idtype_product=${n};`;if((yield i.default.query(p,{type:a.QueryTypes.SELECT})).length!==d.length)return e.status(y).json({message:"Attributes missing on the product type"});let _=yield i.default.transaction();try{return yield i.default.query("INSERT INTO product (SKU, name, price, type_product_idtype_product) VALUES (?,?,?,?);",{replacements:[parseInt(r),u,o,n]}),yield d.forEach((t=>s(void 0,void 0,void 0,(function*(){yield i.default.query("INSERT INTO product_has_attribute(product_SKU, attribute_idattribute, value) VALUES (?,?,?);",{replacements:[parseInt(r),t.idAttribute,t.value]})})))),yield _.commit(),e.status(l).json({message:"Product added successfully"})}catch(t){const r=yield _.rollback();return e.status(f).json({data:t,rollback:r})}})))),c.delete(e.p.delete,((t,e)=>s(void 0,void 0,void 0,(function*(){const{SKU:r}=t.params;if(!r)return e.status(y).json({message:"SKU is missing for delete"});try{const t=`SELECT * FROM product WHERE SKU=${parseInt(r)}`;if(0===(yield i.default.query(t,{type:a.QueryTypes.SELECT})).length)return e.status(y).json({message:"The product SKU does not exist"});yield i.default.query("START TRANSACTION"),yield i.default.query(`DELETE FROM product_has_attribute WHERE product_SKU=${parseInt(r)}`),yield i.default.query(`DELETE FROM product WHERE SKU=${parseInt(r)}`);const s=yield i.default.query("COMMIT");return e.status(p).json({data:s,message:"Product deleted"})}catch(t){const r=yield i.default.query("rollback");return e.status(f).json({data:t,message:t,rollback:r})}})))),e.default=c},603:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=s(r(710)),o=(s(r(470)),s(r(806))),n=s(r(582)),a=s(r(860)),i=s(r(10));r(383);const d=s(r(609)),c=s(r(660)),l=r(654),p=r(350),f=(0,a.default)();f.use((0,n.default)()),f.use(a.default.json()),f.use(a.default.urlencoded({extended:!0})),f.use((0,u.default)()),f.use((0,o.default)()),(0,p.dbConnection)(),f.use("/",d.default),f.use(((t,e,r,s)=>{c.default.err(t,!0);const u=t instanceof l.CustomError?t.HttpStatus:i.default.BAD_REQUEST;return r.status(u).json({error:t.message})})),e.default=f},654:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.UserNotFoundError=e.ParamMissingError=e.CustomError=void 0;const u=s(r(10));class o extends Error{constructor(t,e){super(t),this.HttpStatus=u.default.BAD_REQUEST,this.HttpStatus=e}}e.CustomError=o;class n extends o{constructor(){super(n.Msg,n.HttpStatus)}}e.ParamMissingError=n,n.Msg="One or more of the required parameters was missing.",n.HttpStatus=u.default.BAD_REQUEST;class a extends o{constructor(){super(a.Msg,a.HttpStatus)}}e.UserNotFoundError=a,a.Msg="A user with the given id does not exists in the database.",a.HttpStatus=u.default.NOT_FOUND},944:t=>{t.exports=require("command-line-args")},710:t=>{t.exports=require("cookie-parser")},582:t=>{t.exports=require("cors")},142:t=>{t.exports=require("dotenv")},860:t=>{t.exports=require("express")},383:t=>{t.exports=require("express-async-errors")},806:t=>{t.exports=require("helmet")},10:t=>{t.exports=require("http-status-codes")},660:t=>{t.exports=require("jet-logger")},470:t=>{t.exports=require("morgan")},496:t=>{t.exports=require("sequelize")},17:t=>{t.exports=require("path")}},e={};(function r(s){var u=e[s];if(void 0!==u)return u.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,r),o.exports})(114)})();